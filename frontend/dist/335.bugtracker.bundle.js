"use strict";(Object("undefined"!=typeof self?self:this).webpackChunkBugTracker=Object("undefined"!=typeof self?self:this).webpackChunkBugTracker||[]).push([[335],{335:(t,e,n)=>{n.r(e),n.d(e,{BugReportModal:()=>s});var o=function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function s(t){try{c(o.next(t))}catch(t){i(t)}}function a(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(s,a)}c((o=o.apply(t,e||[])).next())})};class r{constructor(){this.html2canvas=null,this.defaultOptions={},this.cdnUrl="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js",this.setDefaultOptions(),this.checkAvailability()}setDefaultOptions(){this.defaultOptions={scale:.8,useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff",logging:!1,imageTimeout:15e3,removeContainer:!0,onclone:null}}checkAvailability(){"undefined"!=typeof window&&window.html2canvas&&(this.html2canvas=window.html2canvas)}ensureHtml2Canvas(){return o(this,void 0,void 0,function*(){if(!this.html2canvas&&(this.checkAvailability(),!this.html2canvas)){try{const t=yield n.e(354).then(n.t.bind(n,354,23)),e=t&&(t.default||t);if("function"==typeof e)return void(this.html2canvas=e)}catch(t){}yield new Promise((t,e)=>{const n=document.createElement("script");n.src=this.cdnUrl,n.async=!0,n.onload=()=>{this.checkAvailability(),this.html2canvas?t():e(new Error("html2canvas did not expose expected API"))},n.onerror=t=>e(new Error("Failed to load html2canvas script")),document.head.appendChild(n)})}})}isHtml2CanvasAvailable(){return!!this.html2canvas||!!window.html2canvas}setOptions(t){this.defaultOptions=Object.assign(Object.assign({},this.defaultOptions),t)}getOptions(){return Object.assign({},this.defaultOptions)}capture(t,e){return o(this,void 0,void 0,function*(){if(yield this.ensureHtml2Canvas(),!this.html2canvas&&!window.html2canvas)throw new Error("html2canvas is not available");const n=this.html2canvas||window.html2canvas,o=Object.assign(Object.assign({},this.defaultOptions),e);return(yield n(t,o)).toDataURL("image/jpeg",.8)})}capturePreview(t){return o(this,void 0,void 0,function*(){const e=t||document.body,n=Object.assign(Object.assign({},this.defaultOptions),{scale:.3,quality:.5,backgroundColor:null});return this.capture(e,n)})}captureFinal(t){return o(this,void 0,void 0,function*(){const e=t||document.body,n=Object.assign(Object.assign({},this.defaultOptions),{scale:.8,quality:.8,backgroundColor:"#ffffff"});try{return yield this.capture(e,n)}catch(t){const e=Object.assign(Object.assign({},this.defaultOptions),{width:window.innerWidth,height:window.innerHeight,x:window.pageXOffset,y:window.pageYOffset});yield this.ensureHtml2Canvas();const n=this.html2canvas||window.html2canvas;return(yield n(document.body,e)).toDataURL("image/jpeg",.8)}})}captureViewport(){return o(this,void 0,void 0,function*(){const t=Object.assign(Object.assign({},this.defaultOptions),{width:window.innerWidth,height:window.innerHeight,x:window.pageXOffset,y:window.pageYOffset});yield this.ensureHtml2Canvas();const e=this.html2canvas||window.html2canvas;return(yield e(document.body,t)).toDataURL("image/jpeg",.8)})}dataUrlToBlob(t){return o(this,void 0,void 0,function*(){return new Promise(e=>{var n;try{const o=t.split(","),r=(null===(n=o[0].match(/:(.*?);/))||void 0===n?void 0:n[1])||"image/jpeg",i=atob(o[1]);let s=i.length;const a=new Uint8Array(s);for(;s--;)a[s]=i.charCodeAt(s);e(new Blob([a],{type:r}))}catch(t){console.error("Failed to convert data URL to Blob:",t),e(null)}})})}}var i=function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function s(t){try{c(o.next(t))}catch(t){i(t)}}function a(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(s,a)}c((o=o.apply(t,e||[])).next())})};class s{constructor(t,e){this.modal=null,this.content=null,this.screenshotData=null,this.screenshotAllowed=!1,this.rememberConsentKey="bt_screenshot_allowed",this.onSubmit=t,this.onClose=e,this.screenshotCapturer=new r}open(){return i(this,void 0,void 0,function*(){if(!this.modal){this.modal=this.createModal(),document.body.appendChild(this.modal);try{"1"===sessionStorage.getItem(this.rememberConsentKey)&&(this.screenshotAllowed=!0)}catch(t){}yield this.capturePreview()}})}close(){this.modal&&this.modal.parentNode&&(this.modal.parentNode.removeChild(this.modal),this.modal=null,this.content=null),this.onClose()}createModal(){const t=document.createElement("div");return t.className="bugtracker-modal-overlay",t.innerHTML=this.getModalHTML(),this.applyStyles(t),this.attachEventListeners(t),t}capturePreview(t){return i(this,void 0,void 0,function*(){var e,n,o;const r=t||(null===(e=this.content)||void 0===e?void 0:e.querySelector("#bugtracker-screenshot-preview"))||document.body;try{const t=yield this.screenshotCapturer.capturePreview(r);return this.updatePreviewElement(null===(n=this.content)||void 0===n?void 0:n.querySelector("#bugtracker-screenshot-preview"),t),this.screenshotData=t,t}catch(t){throw this.showPreviewError(null===(o=this.content)||void 0===o?void 0:o.querySelector("#bugtracker-screenshot-preview"),t),t}})}submitReport(){return i(this,void 0,void 0,function*(){var t,e,n;const o=null===(t=this.content)||void 0===t?void 0:t.querySelector(".bugtracker-modal-submit"),r=null===(e=this.content)||void 0===e?void 0:e.querySelector("#bugtracker-comment"),i=null===(n=this.content)||void 0===n?void 0:n.querySelector("#bugtracker-email");if(!o||!r)return;const s=r.value.trim();if(!s)return void this.showError("Please describe what went wrong");if(s.length>1e3)return void this.showError("Description must be less than 1000 characters");o.disabled=!0;const a=o.innerHTML;o.innerHTML='\n        <div class="loading-spinner" style="width: 16px; height: 16px; border-width: 2px; margin-right: 6px;"></div>\n        Submitting...\n    ';try{let t=this.screenshotData;if(!t)try{t=yield this.screenshotCapturer.captureFinal()}catch(t){console.warn("Failed to capture final screenshot:",t)}yield this.onSubmit({screenshot:t,comment:s,email:(null==i?void 0:i.value.trim())||void 0}),this.close()}catch(t){console.error("Failed to submit bug report:",t),this.showError("Failed to submit report. Please try again.")}finally{o.disabled=!1,o.innerHTML=a}})}captureScreenshot(){return i(this,void 0,void 0,function*(){var t;const e=null===(t=this.content)||void 0===t?void 0:t.querySelector("#bugtracker-screenshot-preview");if(e)try{this.screenshotData=yield this.screenshotCapturer.capturePreview(e),this.updatePreviewElement(e,this.screenshotData)}catch(t){console.error("Failed to capture screenshot:",t),this.showScreenshotError(e,t)}})}getModalHTML(){return'\n        <div class="bugtracker-modal">\n            <div class="bugtracker-modal-content">\n                <button class="bugtracker-modal-close" aria-label="Close">&times;</button>\n                <h2>Report a bug</h2>\n                <div id="bugtracker-screenshot-area">\n                    <div id="bugtracker-screenshot-preview" class="bugtracker-screenshot-placeholder">No screenshot</div>\n                    <div style="margin-top:8px;">\n                        <button id="bugtracker-capture-btn" type="button">Capture Screenshot</button>\n                    </div>\n                    <div id="bugtracker-screenshot-consent" style="display:none;margin-top:8px;padding:8px;border-radius:4px;background:#f9f9f9;">\n                        <div style="margin-bottom:6px;">Do you allow taking a screenshot of your browser window for this bug report? This will capture visible content only.</div>\n                        <label style="display:flex;align-items:center;gap:6px;margin-bottom:6px;"><input type="checkbox" id="bugtracker-remember-consent" /> Remember my choice for this session</label>\n                        <div>\n                            <button id="bugtracker-allow-screenshot" type="button" style="margin-right:8px;">Allow</button>\n                            <button id="bugtracker-deny-screenshot" type="button">Deny</button>\n                        </div>\n                        <div id="bugtracker-screenshot-consent-error" style="display:none;color:#c62828;margin-top:6px;font-size:12px;"></div>\n                    </div>\n                </div>\n                <textarea id="bugtracker-comment" placeholder="Describe what happened" rows="6"></textarea>\n                <input id="bugtracker-email" placeholder="Your email (optional)" type="email" />\n                <div class="bugtracker-error" style="display:none;color:#c62828;margin-top:8px;"></div>\n                <div style="margin-top:12px;">\n                    <button class="bugtracker-modal-submit">Submit Report</button>\n                </div>\n            </div>\n        </div>\n        '}applyStyles(t){const e=document.createElement("style");e.textContent='\n        .bugtracker-modal-overlay {\n            position: fixed;\n            inset: 0;\n            background: rgba(0,0,0,0.45);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            z-index: 99999;\n        }\n        .bugtracker-modal { max-width: 720px; width: 92%; }\n        .bugtracker-modal-content {\n            background: #fff;\n            border-radius: 8px;\n            padding: 16px;\n            box-shadow: 0 8px 24px rgba(0,0,0,0.2);\n            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;\n        }\n        .bugtracker-modal-close {\n            float: right;\n            background: transparent;\n            border: none;\n            font-size: 20px;\n            cursor: pointer;\n        }\n        #bugtracker-screenshot-preview {\n            width: 100%;\n            height: 160px;\n            background: #f4f4f4;\n            display:flex;\n            align-items:center;\n            justify-content:center;\n            overflow:hidden;\n            border-radius:4px;\n        }\n        #bugtracker-screenshot-preview img { max-width:100%; max-height:100%; display:block; }\n        #bugtracker-comment { width:100%; margin-top:8px; box-sizing:border-box; }\n        #bugtracker-email { width:100%; margin-top:8px; box-sizing:border-box; padding:6px; }\n        .bugtracker-modal-submit { margin-top:8px; padding:8px 12px; cursor:pointer; }\n        ',t.appendChild(e)}attachEventListeners(t){var e,n,o,r,s,a;this.content=t.querySelector(".bugtracker-modal-content");const c=null===(e=this.content)||void 0===e?void 0:e.querySelector(".bugtracker-modal-close");null==c||c.addEventListener("click",()=>this.close());const l=null===(n=this.content)||void 0===n?void 0:n.querySelector(".bugtracker-modal-submit");null==l||l.addEventListener("click",t=>{t.preventDefault(),this.submitReport()});const d=null===(o=this.content)||void 0===o?void 0:o.querySelector("#bugtracker-capture-btn");null==d||d.addEventListener("click",t=>i(this,void 0,void 0,function*(){t.preventDefault(),yield this.requestConsentAndCapture()}));const u=null===(r=this.content)||void 0===r?void 0:r.querySelector("#bugtracker-allow-screenshot");null==u||u.addEventListener("click",t=>i(this,void 0,void 0,function*(){t.preventDefault(),yield this.handleAllowConsent()}));const h=null===(s=this.content)||void 0===s?void 0:s.querySelector("#bugtracker-deny-screenshot");null==h||h.addEventListener("click",t=>{t.preventDefault(),this.handleDenyConsent()});const v=null===(a=this.content)||void 0===a?void 0:a.querySelector("#bugtracker-screenshot-preview");null==v||v.addEventListener("click",()=>i(this,void 0,void 0,function*(){yield this.requestConsentAndCapture()})),t.addEventListener("click",e=>{e.target===t&&this.close()})}requestConsentAndCapture(){return i(this,void 0,void 0,function*(){var t;if(this.screenshotAllowed)return void(yield this.captureScreenshot());const e=null===(t=this.content)||void 0===t?void 0:t.querySelector("#bugtracker-screenshot-consent");e&&(e.style.display="block",e.scrollIntoView({behavior:"smooth",block:"center"}))})}handleAllowConsent(){return i(this,void 0,void 0,function*(){var t,e,n;this.screenshotAllowed=!0;const o=null===(t=this.content)||void 0===t?void 0:t.querySelector("#bugtracker-remember-consent");if(o&&o.checked)try{sessionStorage.setItem(this.rememberConsentKey,"1")}catch(t){console.debug("[BugTracker] Could not persist screenshot consent:",t)}const r=null===(e=this.content)||void 0===e?void 0:e.querySelector("#bugtracker-screenshot-consent");r&&(r.style.display="none");try{yield this.captureScreenshot()}catch(t){const e=null===(n=this.content)||void 0===n?void 0:n.querySelector("#bugtracker-screenshot-consent-error");e&&(e.style.display="block",e.textContent="Screenshot capture failed. You can still submit without a screenshot.")}})}handleDenyConsent(){var t;this.screenshotAllowed=!1;const e=null===(t=this.content)||void 0===t?void 0:t.querySelector("#bugtracker-screenshot-consent");e&&(e.style.display="none"),this.showError("Screenshot denied. You can still submit the report without a screenshot.")}updatePreviewElement(t,e){if(!t)return;t.innerHTML="";const n=document.createElement("img");n.src=e,n.alt="Screenshot preview",t.appendChild(n)}showPreviewError(t,e){console.error("Preview capture error:",e),t&&(t.textContent="Failed to capture preview"),this.showError("Failed to capture preview screenshot")}showScreenshotError(t,e){console.error("Screenshot error:",e),t.textContent="Failed to capture screenshot",this.showError("Failed to capture screenshot")}showError(t){var e;const n=null===(e=this.content)||void 0===e?void 0:e.querySelector(".bugtracker-error");n&&(n.textContent=t,n.style.display="block",setTimeout(()=>{n.style.display="none"},5e3))}}}}]);